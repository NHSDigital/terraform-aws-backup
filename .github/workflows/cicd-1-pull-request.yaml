name: "CI/CD pull request"

on:
  push:
    branches:
      - "**"
  pull_request:
    types: [opened, reopened]

jobs:
  check-version:
    name: "Check version"
    runs-on: ubuntu-latest
    steps:
      - name: "Checkout code"
        uses: actions/checkout@v3
        with:
          # Fetch all history for all branches and tags
          fetch-depth: 0

      - name: Run Version Check
        run: |
          ./check_and_get_version.sh modules/aws-backup-source/version > version_output.txt
          while IFS= read -r line; do
            echo "$line" >> $GITHUB_OUTPUT
            echo "$line" >> $GITHUB_ENV
          done < version_output.txt

          echo "ðŸŽ‰ Version check passed! Ready to proceed with version ${{ env.VERSION }}"
          if [ "${{ env.IS_GREATER }}" = "true" ]; then exit 0; else exit 1; fi
